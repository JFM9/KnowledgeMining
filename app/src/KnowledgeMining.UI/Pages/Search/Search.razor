@page "/search/{Index}/{Hash?}"

<style>
    .hide-input > .mud-input-control {
        display: none;
    }
</style>

<PageTitle>Search</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudGrid>
        <MudItem xs="12" md="12">
            <MudTextField   @bind-Value="SearchText" 
                            Label="Search" 
                            Clearable="true"
                            Immediate="true"
                            Adornment="Adornment.End" 
                            AdornmentIcon="@Icons.Filled.Search"
                            AdornmentColor="Color.Primary"
                            OnClearButtonClick="@SearchIfClearClicked"
                            OnKeyUp="@SearchIfEnterPressed"
                            OnAdornmentClick="@SearchIfButtonClicked" 
                            Variant="Variant.Outlined" 
                            Margin="Margin.None"
                            />
        </MudItem>
        <MudItem xs="12" md="12">
            <MudToolBar Style="height: 20px">
                <MudText><MudIcon Icon="@Icons.Filled.CalendarMonth" Color="Color.Primary" Title="Time Span"></MudIcon> Time Span:</MudText>
                <MudMenu EndIcon="@Icons.Filled.ArrowDropDown" Label="@_timespanLabel">
                    <MudMenuItem OnClick="@TimeSpanAnyOnClick">Any</MudMenuItem>
                    <MudMenuItem OnClick="@TimeSpanTodayOnClick">Today</MudMenuItem>
                    <MudMenuItem OnClick="@TimeSpanThisWeekOnClick">This Week</MudMenuItem>
                    <MudMenuItem OnClick="@TimeSpanThisMonthOnClick">This Month</MudMenuItem>
                    <MudMenuItem OnClick="@TimeSpanCustomOnClick">Custom</MudMenuItem>
                </MudMenu>
                <MudText Class="pl-6"><MudIcon Icon="@Icons.Filled.Sort" Color="Color.Primary" Title="Sort By"></MudIcon> Sort By:</MudText>
                <MudMenu EndIcon="@Icons.Filled.ArrowDropDown" Label="@_sortLabel" Disabled="@(_searchState?.TotalCount == 0)">
                    <MudMenuItem OnClick="@SortBestMatchClicked">Best Match</MudMenuItem>
                    <MudMenuItem OnClick="@SortDateClicked">Date</MudMenuItem>
                </MudMenu>

                <MudSpacer />
                <MudButton Disabled="@DisableClearFilter()"
                    StartIcon="@Icons.Filled.Clear"
                    Color="Color.Error"
                    OnClick="ClearSearch">Clear Filters</MudButton>
            </MudToolBar>
        </MudItem>
        <MudItem xs="12">
        <MudDivider Light="true" />
        </MudItem>
        <MudItem xs="12" md="2" hidden="@_showDocumentDetails">    
                <FacetsFilterComponent 
                    @ref="_facetsFilterComponent"
                    Facets="@_searchState.Facets"
                    OnFacetSelectedChanged="UpdateSearchFacetsAndSearch"
                    IndexItem="_indexItem"></FacetsFilterComponent>
        </MudItem>
        <MudItem xs="12" md="10" hidden="@_showDocumentDetails">
            <MudTabs @ref="_mainBodyTabs" Elevation="0" Outlined="true" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6" Class="">
                <div class="d-flex flex-column">
                    <MudTabPanel @ref="_searchResultsPanel" Text="@_searchResultsLabel">
                        <SearchResultsComponent @ref="_searchResultsComponent"
                            DocumentWrapper="@GetDocumentMetadataWrapper()"
                            IsLoading="@_isSearching" TotalCount="@_searchState.TotalCount" TotalPages="@_searchState.TotalPages" 
                            NavigateTo="@($"/record/{Index}/")" OnPageSelectedChanged="@SearchPageSelected" 
                            PageSelected="@_selectedPage"></SearchResultsComponent>
                    </MudTabPanel>
                    <MudTabPanel Text="Entity Map">
                        <EntityMapComponent FacetableFields="@_searchState.FacetableFields" IndexName="@_indexItem.IndexName" SearchText="@SearchText" />
                    </MudTabPanel>
                </div>
            </MudTabs>
        </MudItem>
        <MudItem xs="12" md="12" hidden="@(!_showDocumentDetails)">
            <DocumentDetailsComponentTest ReturnTo="@($"/search/{Index}/")"
                Document="_documentMetadata"></DocumentDetailsComponentTest>
        </MudItem>
    </MudGrid>
    <MudDateRangePicker @ref="_timespanPicker" class="hide-input"
                    PickerVariant="PickerVariant.Dialog" 
                    Label="Time span" 
                    MinDate="_minDate"
                    MaxDate="_maxDate"
                    DateRangeChanged="@TimeSpanCustomRangeChanged" />
</MudContainer>

